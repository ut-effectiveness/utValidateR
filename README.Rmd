---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# utValidateR <img src="man/figures/README-ut_ie_logo.png" align="right" width="120" />

<!-- badges: start -->
[![Lifecycle: experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![Codecov test coverage](https://codecov.io/gh/ut-effectiveness/utValidateR/branch/master/graph/badge.svg)](https://app.codecov.io/gh/ut-effectiveness/utValidateR?branch=master)
<!-- badges: end -->

The **utValidateR** package helps ensure data accuracy and consistency for reporting and auditing purposes. It is designed to validate data based on specific rules and metadata, with the goal of validating elements within the warehouse ETL pipeline or elements in the reporting layer. The functions in this library are used in USHE and IPEDS reporting and also form the basis for campus data audits. It stores rule definitions in `data-raw/checklist.R` as the `checklist` object, and metadata in `sandbox/rule-metadata.csv`, generated from an Excel file. Auxiliary information is contained in the `aux_info` data object, which requires manual updates. Test data for unit tests and interactive comparisons is located in `inst/testdata/`. Development workflows include running unit tests with `devtools::test()` and investigating mismatches using `compare_rule_output()`. The `do_checks()` function is used to perform the actual data validation checks, and the `get_checklist()` function helps retrieve and manage these rules. These two functions are the most important as they form the core of the package's validation process. For more details, refer to the package vignette.

### Deliverables
- **Rule Definitions**: `checklist` object in `data-raw/checklist.R`
- **Metadata**: `sandbox/rule-metadata.csv`
- **Auxiliary Information**: `aux_info` data object
- **Test Data**: Located in `inst/testdata/`
- **Unit Tests**: Executed via `devtools::test()`
- **Interactive Comparison Tool**: `compare_rule_output()` function
- **Validation Checks**: `do_checks()` function
- **Rule Retrieval**: `get_checklist()` function



## Installation

You can install the development version of utValidateR from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("ut-effectiveness/utValidateR", ref = "develop")
```

## Contributing

Changes to the R code for performing each rule check should be made in data-raw/checklist.R, in the `rule_spec` object. Functions used by these checks are defined in R/checker-helpers.R. Data objects referenced in the checker functions are provided in `aux_info`, which can be modified in data-raw/aux_info.R. 

See `vignette("development", package = "utValidateR")` (or view its source in vignettes/development.Rmd) for more information on development workflows and needs. 

Specific questions or requests can be submitted as github issues.  

## Using

The following is an example of applying `do_checks()` to the supplied `fake_student_df` dataset. Further examples and orientation are provided in vignettes/database-checks.Rmd, which (if installed with `build_vignettes = TRUE`) can be viewed via `vignette("database-checks")`.

```{r}
library(utValidateR)
library(dplyr)
data("fake_student_df")
data("checklist")
data("aux_info")

student_checks <- get_checklist(file = "student", type = "database") %>% 
  glimpse()

student_check_result <- suppressMessages(suppressWarnings( # suppressing rather verbose error descriptions
  do_checks(df_tocheck = fake_student_df, 
            checklist = student_checks, 
            aux_info = aux_info)
))

glimpse(student_check_result)
```

