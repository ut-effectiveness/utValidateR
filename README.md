
<!-- README.md is generated from README.Rmd. Please edit that file -->

# utValidateR <img src="man/figures/README-ut_ie_logo.png" align="right" width="120" />

<!-- badges: start -->

[![Lifecycle:
experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html#experimental)
[![Codecov test
coverage](https://codecov.io/gh/ut-effectiveness/utValidateR/branch/master/graph/badge.svg)](https://app.codecov.io/gh/ut-effectiveness/utValidateR?branch=master)
<!-- badges: end -->

The **utValidateR** package helps ensure data accuracy and consistency
for reporting and auditing purposes. It is designed to validate data
based on specific rules and metadata, with the goal of validating
elements within the warehouse ETL pipeline or elements in the reporting
layer. The functions in this library are used in USHE and IPEDS
reporting and also form the basis for campus data audits. It stores rule
definitions in `data-raw/checklist.R` as the `checklist` object, and
metadata in `sandbox/rule-metadata.csv`, generated from an Excel file.
Auxiliary information is contained in the `aux_info` data object, which
requires manual updates. Test data for unit tests and interactive
comparisons is located in `inst/testdata/`. Development workflows
include running unit tests with `devtools::test()` and investigating
mismatches using `compare_rule_output()`. The `do_checks()` function is
used to perform the actual data validation checks, and the
`get_checklist()` function helps retrieve and manage these rules. These
two functions are the most important as they form the core of the
package’s validation process. For more details, refer to the package
vignette.

### Deliverables

- **Rule Definitions**: `checklist` object in `data-raw/checklist.R`
- **Metadata**: `sandbox/rule-metadata.csv`
- **Auxiliary Information**: `aux_info` data object
- **Test Data**: Located in `inst/testdata/`
- **Unit Tests**: Executed via `devtools::test()`
- **Interactive Comparison Tool**: `compare_rule_output()` function
- **Validation Checks**: `do_checks()` function
- **Rule Retrieval**: `get_checklist()` function

## Installation

You can install the development version of utValidateR from
[GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("ut-effectiveness/utValidateR", ref = "develop")
```

## Contributing

Changes to the R code for performing each rule check should be made in
data-raw/checklist.R, in the `rule_spec` object. Functions used by these
checks are defined in R/checker-helpers.R. Data objects referenced in
the checker functions are provided in `aux_info`, which can be modified
in data-raw/aux_info.R.

See `vignette("development", package = "utValidateR")` (or view its
source in vignettes/development.Rmd) for more information on development
workflows and needs.

Specific questions or requests can be submitted as github issues.

## Using

The following is an example of applying `do_checks()` to the supplied
`fake_student_df` dataset. Further examples and orientation are provided
in vignettes/database-checks.Rmd, which (if installed with
`build_vignettes = TRUE`) can be viewed via
`vignette("database-checks")`.

``` r
library(utValidateR)
library(dplyr)
#> 
#> Attaching package: 'dplyr'
#> The following objects are masked from 'package:stats':
#> 
#>     filter, lag
#> The following objects are masked from 'package:base':
#> 
#>     intersect, setdiff, setequal, union
data("fake_student_df")
data("checklist")
data("aux_info")

student_checks <- get_checklist(file = "student", type = "database") %>% 
  glimpse()
#> Rows: 65
#> Columns: 9
#> $ rule          <chr> "S00a", "S00b", "S04b", "S05a", "S06a", "S06b", "S06c", …
#> $ ref_rule      <chr> "S00a", "S00b", "S04b", "S05a", "S06a", "S06b", "S06c", …
#> $ description   <chr> "duplicate student_id's", "duplicate ssn", "invalid ssn"…
#> $ status        <chr> "Failure", "Failure", "Failure", "Failure", "Failure", "…
#> $ type          <chr> "Database", "Database", "Database", "Database", "Databas…
#> $ activity_date <chr> "spriden_activity_date", "spbpers_activity_date", "spbpe…
#> $ banner        <chr> "banner.spriden_id", "banner.spbpers_ssn", "banner.spbpe…
#> $ checker       <list> <!is_duplicated(cbind(student_id, term_id))>, <!is_dupl…
#> $ file          <chr> "Student", "Student", "Student", "Student", "Student", "…

student_check_result <- suppressMessages(suppressWarnings( # suppressing rather verbose error descriptions
  do_checks(df_tocheck = fake_student_df, 
            checklist = student_checks, 
            aux_info = aux_info)
))

glimpse(student_check_result)
#> Rows: 10,000
#> Columns: 147
#> $ ssn                                     <chr> "217-27-9349", "616-16-4183", …
#> $ first_name                              <chr> "Ever", "Burke", "Illa", "Brys…
#> $ last_name                               <chr> "Hettinger", "Zulauf", "Price"…
#> $ middle_name                             <chr> NA, NA, NA, NA, "Bob", NA, NA,…
#> $ previous_last_name                      <chr> NA, NA, NA, NA, "Smith", "Smit…
#> $ previous_first_name                     <chr> NA, NA, NA, NA, NA, NA, "Erin"…
#> $ preferred_first_name                    <chr> NA, "Deb", "Deb", NA, NA, "Joe…
#> $ preferred_middle_name                   <chr> NA, NA, NA, NA, NA, NA, NA, NA…
#> $ local_address_zip_code                  <chr> "56047-8572", "74312-5691", "5…
#> $ mailing_address_zip_code                <chr> "72952-0341", "80595-8818", "9…
#> $ us_citizenship_code                     <chr> "2", "1", NA, "6", "1", "9", "…
#> $ first_admit_county_code                 <chr> "9", "15", NA, NA, "35", "31",…
#> $ first_admit_state_code                  <chr> "UT", "UT", "UT", "UT", "UT", …
#> $ first_admit_country_code                <chr> "US", "US", "US", "US", "US", …
#> $ residential_housing_code                <chr> "R", "A", "G", "G", "R", "G", …
#> $ student_id                              <chr> "00397002", "00016524", "00532…
#> $ ssid                                    <chr> "2345678", "1234567", "2", "34…
#> $ previous_student_id                     <lgl> NA, NA, NA, NA, NA, NA, NA, NA…
#> $ birth_date                              <date> 1999-06-13, 1989-03-29, 2009-…
#> $ gender_code                             <chr> "M", "F", "F", "M", "F", NA, "…
#> $ is_hispanic_latino_ethnicity            <lgl> TRUE, FALSE, TRUE, TRUE, TRUE,…
#> $ is_asian                                <lgl> FALSE, FALSE, TRUE, TRUE, TRUE…
#> $ is_black                                <lgl> TRUE, FALSE, TRUE, TRUE, TRUE,…
#> $ is_american_indian_alaskan              <lgl> FALSE, TRUE, FALSE, FALSE, FAL…
#> $ is_hawaiian_pacific_islander            <lgl> TRUE, FALSE, TRUE, TRUE, TRUE,…
#> $ is_white                                <lgl> TRUE, TRUE, FALSE, FALSE, TRUE…
#> $ is_international                        <lgl> TRUE, TRUE, TRUE, FALSE, TRUE,…
#> $ is_other_race                           <lgl> FALSE, FALSE, FALSE, TRUE, FAL…
#> $ primary_major_cip_code                  <chr> "95053", "57253", "50381", "23…
#> $ student_type_code                       <chr> "2", "P", "N", "C", "0", "2", …
#> $ primary_level_class_id                  <chr> "SR", "SO", "GG", "SR", "FR", …
#> $ primary_degree_id                       <chr> NA, "BSN", "MA", NA, "BFA", "A…
#> $ institutional_cumulative_credits_earned <dbl> 130.3, 183.3, 177.5, 97.0, 135…
#> $ institutional_cumulative_gpa            <dbl> 2.62, 3.69, 2.74, 3.42, 2.16, …
#> $ full_time_part_time_code                <chr> "F", "F", "F", "F", NA, "F", "…
#> $ transfer_cumulative_credits_earned      <dbl> 111.5, 0.3, 62.5, 176.0, 220.3…
#> $ secondary_major_cip_code                <chr> "60901", "77717", "49402", "20…
#> $ act_composite_score                     <int> 6, 1, 18, 34, 25, 32, 16, 14, …
#> $ act_english_score                       <int> 22, 36, 36, 30, 10, 33, 30, 23…
#> $ act_math_score                          <int> 13, 14, 7, 10, 22, 33, 29, 23,…
#> $ act_reading_score                       <int> 5, 36, 15, 32, 31, 16, 31, 30,…
#> $ act_science_score                       <int> 26, 25, 26, 30, 1, 23, 8, 11, …
#> $ high_school_graduation_date             <date> 2012-04-10, 2010-04-24, 2017-…
#> $ is_pell_eligible                        <lgl> FALSE, FALSE, FALSE, TRUE, FAL…
#> $ is_pell_awarded                         <lgl> TRUE, FALSE, FALSE, TRUE, TRUE…
#> $ is_bia                                  <lgl> FALSE, FALSE, FALSE, TRUE, FAL…
#> $ primary_major_college_id                <chr> "CT", "SC", "HS", "EF", "NS", …
#> $ primary_major_college_desc              <chr> "Mathematics", "Coll of Humani…
#> $ secondary_major_college_id              <chr> "GE", "FA", "EF", "NS", "EF", …
#> $ secondary_major_college_desc            <chr> "College of Education", "Compu…
#> $ level_id                                <chr> "NC", "CE", "NC", "CE", "UG", …
#> $ term_id                                 <dbl> 201140, 201820, 201820, 202120…
#> $ sgbstdn_activity_date                   <date> 2019-12-31, 2018-11-02, 2021-…
#> $ spriden_activity_date                   <date> 2021-12-25, 2018-04-20, 2021-…
#> $ sabsupl_activity_date                   <date> 2021-05-02, 2019-05-23, 2018-…
#> $ S00a_activity_date                      <date> 2021-12-25, 2018-04-20, 2021-…
#> $ S00a_error_age                          <dbl> 1046, 2391, 1097, 2401, 1666, …
#> $ S00a_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S00b_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S04b_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S05a_status                             <chr> "`is_valid_previous_id(previou…
#> $ S06a_activity_date                      <date> 2021-12-25, 2018-04-20, 2021-…
#> $ S06a_error_age                          <dbl> 1046, 2391, 1097, 2401, 1666, …
#> $ S06a_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S06b_activity_date                      <date> 2021-12-25, 2018-04-20, 2021-…
#> $ S06b_error_age                          <dbl> 1046, 2391, 1097, 2401, 1666, …
#> $ S06b_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S06c_activity_date                      <date> 2021-12-25, 2018-04-20, 2021-…
#> $ S06c_error_age                          <dbl> 1046, 2391, 1097, 2401, 1666, …
#> $ S06c_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S06d_activity_date                      <date> 2021-12-25, 2018-04-20, 2021-…
#> $ S06d_error_age                          <dbl> 1046, 2391, 1097, 2401, 1666, …
#> $ S06d_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S06e_activity_date                      <date> 2021-12-25, 2018-04-20, 2021-…
#> $ S06e_error_age                          <dbl> 1046, 2391, 1097, 2401, 1666, …
#> $ S06e_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S07a_activity_date                      <date> 2021-12-25, 2018-04-20, 2021-…
#> $ S07a_error_age                          <dbl> 1046, 2391, 1097, 2401, 1666, …
#> $ S07a_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S07b_activity_date                      <date> 2021-12-25, 2018-04-20, 2021-…
#> $ S07b_error_age                          <dbl> 1046, 2391, 1097, 2401, 1666, …
#> $ S07b_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S09a_status                             <chr> "Pass", "Pass", "Failure", "Pa…
#> $ S10a_activity_date                      <date> 2021-05-02, 2019-05-23, 2018-…
#> $ S10a_error_age                          <dbl> 1283, 1993, 2473, 1359, 1110, …
#> $ S10a_status                             <chr> "Pass", "Pass", "Failure", "Fa…
#> $ S11a_activity_date                      <date> 2021-05-02, 2019-05-23, 2018-…
#> $ S11a_error_age                          <dbl> 1283, 1993, 2473, 1359, 1110, …
#> $ S11a_status                             <chr> "Failure", "Failure", "Failure…
#> $ S12_status                              <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S13_status                              <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S16a_status                             <chr> "Failure", "Failure", "Failure…
#> $ S17c_activity_date                      <date> 2019-12-31, 2018-11-02, 2021-…
#> $ S17c_error_age                          <dbl> 1771, 2195, 1372, 1968, 1662, …
#> $ S17c_status                             <chr> "`TODO(\"How to compare to pre…
#> $ S17d_activity_date                      <date> 2019-12-31, 2018-11-02, 2021-…
#> $ S17d_error_age                          <dbl> 1771, 2195, 1372, 1968, 1662, …
#> $ S17d_status                             <chr> "`TODO(\"same question as S17c…
#> $ S18a_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S20a_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S21a_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S22a_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S23c_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S24a_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S25a_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S26b_status                             <chr> "`TODO(\"Not relevant to compa…
#> $ S27a_activity_date                      <date> 2021-05-02, 2019-05-23, 2018-…
#> $ S27a_error_age                          <dbl> 1283, 1993, 2473, 1359, 1110, …
#> $ S27a_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S27b_activity_date                      <date> 2021-05-02, 2019-05-23, 2018-…
#> $ S27b_error_age                          <dbl> 1283, 1993, 2473, 1359, 1110, …
#> $ S27b_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S27c_activity_date                      <date> 2021-05-02, 2019-05-23, 2018-…
#> $ S27c_error_age                          <dbl> 1283, 1993, 2473, 1359, 1110, …
#> $ S27c_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S30a_status...116                       <chr> "Failure", "Failure", "Failure…
#> $ S30a_status...117                       <chr> "Failure", "Failure", "Failure…
#> $ S34a_status                             <chr> "Pass", "Pass", "Failure", "Fa…
#> $ S34b_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S34c_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S34e_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S35a_activity_date                      <date> 2021-12-25, 2018-04-20, 2021-…
#> $ S35a_error_age                          <dbl> 1046, 2391, 1097, 2401, 1666, …
#> $ S35a_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S35b_activity_date                      <date> 2021-12-25, 2018-04-20, 2021-…
#> $ S35b_error_age                          <dbl> 1046, 2391, 1097, 2401, 1666, …
#> $ S35b_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S36a_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S38a_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S39a_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S40a_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S41a_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S42a_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S43b_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S46a_activity_date                      <date> 2019-12-31, 2018-11-02, 2021-…
#> $ S46a_error_age                          <dbl> 1771, 2195, 1372, 1968, 1662, …
#> $ S46a_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S46b_activity_date                      <date> 2019-12-31, 2018-11-02, 2021-…
#> $ S46b_error_age                          <dbl> 1771, 2195, 1372, 1968, 1662, …
#> $ S46b_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S47a_activity_date                      <date> 2019-12-31, 2018-11-02, 2021-…
#> $ S47a_error_age                          <dbl> 1771, 2195, 1372, 1968, 1662, …
#> $ S47a_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ S48a_activity_date                      <date> 2019-12-31, 2018-11-02, 2021-…
#> $ S48a_error_age                          <dbl> 1771, 2195, 1372, 1968, 1662, …
#> $ S48a_status                             <chr> "Pass", "Pass", "Pass", "Pass"…
#> $ UTS02_status                            <chr> "Pass", "Pass", "Pass", "Pass"…
```
